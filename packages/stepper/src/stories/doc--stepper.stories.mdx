import { ArgsTable, Canvas, Meta, Story } from "@storybook/addon-docs";
import { componentArgs } from "../constants";
import {
  ComponentTitle,
  DarkThemeNotice,
  InstallationInstructions,
  VariantRangeNotice,
  VersionNotice
} from "../../../docs/src/partials";
import { StepIconComponent } from "../index.js";
import { version, peerDependencies } from "../../package.json";
import Box from "@mui/material/Box";
import Button from "@mui/material/Button";
import Step from "@mui/material/Step";
import StepButton from "@mui/material/StepButton";
import StepContent from "@mui/material/StepContent";
import StepLabel from "@mui/material/StepLabel";
import Stepper from "@mui/material/Stepper";
import Typography from "@iccc/typography";
import prettier from "prettier/standalone";
import prettierBabel from "prettier/parser-babel";

<Meta
  args={{
    activeStep: 0,
    nonLinear: false,
    orientation: "vertical"
  }}
  argTypes={componentArgs}
  component={Stepper}
  id="components/stepper"
  title="Digital HIG/Components/Stepper"
/>

<ComponentTitle name="Stepper" status="In progress" />

<code>
  <VersionNotice packageName="stepper" version={version} />
</code>

The Stepper component is the out-of-the-box MUI [`<Stepper>`](https://mui.com/material-ui/react-stepper/), with Digital HIG defaults.

For related design documentation, please see the Digital HIG [Figma UI Toolkit](https://www.figma.com/file/Eks986gkqncHjkLnwQjO7g/iccc-sticker-sheets?type=design&node-id=4203-241203).

## Installation

<InstallationInstructions
  name="@iccc/stepper"
  peerDependencies={peerDependencies}
/>

```jsx
import Stepper from "@mui/material/Stepper";
import Step from "@mui/material/Step";
import StepButton from "@mui/material/StepButton";
import StepContent from "@mui/material/StepContent";
import StepLabel from "@mui/material/StepLabel";
import { StepIconComponent } from "@iccc/stepper";
```

## API

- For all supported MUI `<Stepper />` props, see [Stepper API](https://mui.com/material-ui/api/stepper/).
- For all supported MUI `<Step />` props, see [Step API](https://mui.com/material-ui/api/step/).
- For all supported MUI `<StepButton />` props, see [StepButton API](https://mui.com/material-ui/api/step-button/).
- For all supported MUI `<StepContent />` props, see [StepContent API](https://mui.com/material-ui/api/step-content/).
- For all supported MUI `<StepLabel />` props, see [StepLabel API](https://mui.com/material-ui/api/step-label/).

<Canvas>
  <Story name="API">
    {(args) => {
      return (
        <Stepper {...args} alternativeLabel={args.orientation === "horizontal"}>
          <Step>
            <StepButton>
              <StepLabel StepIconComponent={StepIconComponent}>
                Profile data
              </StepLabel>
            </StepButton>
          </Step>
          <Step>
            <StepButton>
              <StepLabel StepIconComponent={StepIconComponent}>
                Personal interests
              </StepLabel>
            </StepButton>
          </Step>
          <Step>
            <StepButton>
              <StepLabel StepIconComponent={StepIconComponent}>
                Verification
              </StepLabel>
            </StepButton>
          </Step>
        </Stepper>
      );
    }}
  </Story>
</Canvas>

<ArgsTable story="API" />

## Stepper variants

<VariantRangeNotice />

### Icons

To ensure the correct icons are used, the `StepIconComponent` can be imported from `@iccc/stepper`. The possible states are demonstrated below.

- The **active** state is defined by the `activeStep` prop provided to the `<Stepper />` component
- The **completed** state is defined by the `completed` prop provided to the `<Step />` component
- The **error** state is defined by the `error` prop provided to the `<StepLabel />` component
- The **disabled** state is applied automatically in the linear variant to all incomplete steps, but can be added manually by passing the `disabled` prop to the `<Step />` component

<Canvas>
  <Story name="Icons: completed">
    <Stepper activeStep={1} orientation="vertical">
      <Step completed>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>Completed</StepLabel>
        </StepButton>
      </Step>
      <Step completed>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>
            Completed, active
          </StepLabel>
        </StepButton>
      </Step>
      <Step>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>Disabled</StepLabel>
        </StepButton>
      </Step>
    </Stepper>
  </Story>
</Canvas>

<Canvas>
  <Story name="Icons: error">
    <Stepper activeStep={1} orientation="vertical" nonLinear>
      <Step>
        <StepButton>
          <StepLabel error StepIconComponent={StepIconComponent}>
            Error
          </StepLabel>
        </StepButton>
      </Step>
      <Step>
        <StepButton>
          <StepLabel error StepIconComponent={StepIconComponent}>
            Error, active
          </StepLabel>
        </StepButton>
      </Step>
      <Step disabled>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>Disabled</StepLabel>
        </StepButton>
      </Step>
    </Stepper>
  </Story>
</Canvas>

<Canvas>
  <Story name="Icons: incomplete">
    <Stepper activeStep={1} orientation="vertical" nonLinear>
      <Step>
        <StepButton>
          <StepLabel
            StepIconComponent={(props) => (
              <StepIconComponent {...props} icon={null} />
            )}
          >
            Incomplete
          </StepLabel>
        </StepButton>
      </Step>
      <Step>
        <StepButton>
          <StepLabel
            StepIconComponent={(props) => (
              <StepIconComponent {...props} icon={null} />
            )}
          >
            Incomplete, active
          </StepLabel>
        </StepButton>
      </Step>
      <Step disabled>
        <StepButton>
          <StepLabel
            StepIconComponent={(props) => (
              <StepIconComponent {...props} icon={null} />
            )}
          >
            Disabled
          </StepLabel>
        </StepButton>
      </Step>
    </Stepper>
  </Story>
</Canvas>

<Canvas>
  <Story name="Icons: incomplete (numeric)">
    <Stepper activeStep={1} orientation="vertical" nonLinear>
      <Step>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>
            Incomplete (numeric)
          </StepLabel>
        </StepButton>
      </Step>
      <Step>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>
            Incomplete, active (numeric)
          </StepLabel>
        </StepButton>
      </Step>
      <Step disabled>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>
            Disabled (numeric)
          </StepLabel>
        </StepButton>
      </Step>
    </Stepper>
  </Story>
</Canvas>

### Orientation

#### Horizontal

_In progress_

If using a label, set the `alternativeLabel` prop to `true` for this orientation.

<Canvas>
  <Story name="Horizontal">
    <Stepper activeStep={1} alternativeLabel>
      <Step>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>
            Profile data
          </StepLabel>
        </StepButton>
      </Step>
      <Step>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>
            Personal interests
          </StepLabel>
        </StepButton>
      </Step>
      <Step>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>
            Verification
          </StepLabel>
        </StepButton>
      </Step>
    </Stepper>
  </Story>
</Canvas>

#### Vertical

<Canvas>
  <Story name="Vertical">
    <Stepper activeStep={1} orientation="vertical">
      <Step>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>
            Profile data
          </StepLabel>
        </StepButton>
      </Step>
      <Step>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>
            Personal interests
          </StepLabel>
        </StepButton>
      </Step>
      <Step>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>
            Verification
          </StepLabel>
        </StepButton>
      </Step>
    </Stepper>
  </Story>
</Canvas>

### Non-numeric

By default, each step will be numbered. To achieve the non-numeric variant, ensure that the `icon` prop passed to the `StepIconComponent` is set to `null`.

<Canvas>
  <Story name="Non-numeric">
    <>
      <Stepper activeStep={1} alternativeLabel>
        <Step>
          <StepButton>
            <StepLabel
              StepIconComponent={(props) => (
                <StepIconComponent {...props} icon={null} />
              )}
            >
              Profile data
            </StepLabel>
          </StepButton>
        </Step>
        <Step>
          <StepButton>
            <StepLabel
              StepIconComponent={(props) => (
                <StepIconComponent {...props} icon={null} />
              )}
            >
              Personal interests
            </StepLabel>
          </StepButton>
        </Step>
        <Step>
          <StepButton>
            <StepLabel
              StepIconComponent={(props) => (
                <StepIconComponent {...props} icon={null} />
              )}
            >
              Verification
            </StepLabel>
          </StepButton>
        </Step>
      </Stepper>
      <Box py={4} />
      <Stepper activeStep={1} orientation="vertical">
        <Step>
          <StepButton>
            <StepLabel
              StepIconComponent={(props) => (
                <StepIconComponent {...props} icon={null} />
              )}
            >
              Profile data
            </StepLabel>
          </StepButton>
        </Step>
        <Step>
          <StepButton>
            <StepLabel
              StepIconComponent={(props) => (
                <StepIconComponent {...props} icon={null} />
              )}
            >
              Personal interests
            </StepLabel>
          </StepButton>
        </Step>
        <Step>
          <StepButton>
            <StepLabel
              StepIconComponent={(props) => (
                <StepIconComponent {...props} icon={null} />
              )}
            >
              Verification
            </StepLabel>
          </StepButton>
        </Step>
      </Stepper>
    </>
  </Story>
</Canvas>

### Non-linear

Non-linear steppers allow the user to enter a multi-step flow at any point. Use the `nonLinear` prop to achieve this. Below is one possible implementation.

<Canvas>
  <Story
    name="Non-linear"
    parameters={{
      docs: {
        source: {
          type: "code"
        },
        transformSource: (input) =>
          prettier.format(input, {
            parser: "babel",
            plugins: [prettierBabel]
          })
      }
    }}
  >
    {() => {
      const [activeStep, setActiveStep] = React.useState(0);
      const [completed, setCompleted] = React.useState({});
      const steps = ["Profile data", "Personal interests", "Verification"];
      const totalSteps = () => {
        return steps.length;
      };
      const completedSteps = () => {
        return Object.keys(completed).length;
      };
      const isLastStep = () => {
        return activeStep === totalSteps() - 1;
      };
      const allStepsCompleted = () => {
        return completedSteps() === totalSteps();
      };
      const handleNext = () => {
        const newActiveStep =
          isLastStep() && !allStepsCompleted()
            ? steps.findIndex((step, i) => !(i in completed))
            : activeStep + 1;
        setActiveStep(newActiveStep);
      };
      const handleBack = () => {
        setActiveStep((prevActiveStep) => prevActiveStep - 1);
      };
      const handleStep = (step) => () => {
        setActiveStep(step);
      };
      const handleComplete = () => {
        const newCompleted = completed;
        newCompleted[activeStep] = true;
        setCompleted(newCompleted);
        handleNext();
      };
      const handleReset = () => {
        setActiveStep(0);
        setCompleted({});
      };
      return (
        <Box width="100%">
          <Stepper nonLinear activeStep={activeStep} alternativeLabel>
            {steps.map((label, index) => (
              <Step key={label} completed={completed[index]}>
                <StepButton>
                  <StepLabel
                    StepIconComponent={(props) => (
                      <StepIconComponent {...props} icon={null} />
                    )}
                    onClick={handleStep(index)}
                  >
                    {label}
                  </StepLabel>
                </StepButton>
              </Step>
            ))}
          </Stepper>
          <Box
            display="flex"
            justifyContent="space-between"
            mt={3}
            alignItems="center"
          >
            {allStepsCompleted() ? (
              <>
                <Typography>
                  All steps completed - you&apos;re finished
                </Typography>
                <Button onClick={handleReset}>Reset</Button>
              </>
            ) : (
              <>
                <Typography>Step {activeStep + 1}</Typography>
                <Box
                  display="flex"
                  flexDirection="row"
                  gap={1}
                  alignItems="center"
                >
                  <Button disabled={activeStep === 0} onClick={handleBack}>
                    Back
                  </Button>
                  <Button onClick={handleNext}>Next</Button>
                  {activeStep !== steps.length && (
                    <Button
                      onClick={handleComplete}
                      disabled={completed[activeStep]}
                    >
                      {completed[activeStep]
                        ? `Step ${activeStep + 1} already completed`
                        : completedSteps() === totalSteps() - 1
                        ? "Finish"
                        : "Complete Step"}
                    </Button>
                  )}
                </Box>
              </>
            )}
          </Box>
        </Box>
      );
    }}
  </Story>
</Canvas>

### Content

Use the `<StepContent />` MUI component to include additional content.

<Canvas>
  <Story name="Content">
    <Stepper activeStep={1} orientation="vertical">
      <Step>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>
            Profile data
          </StepLabel>
        </StepButton>
      </Step>
      <Step>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>
            Personal interests
          </StepLabel>
        </StepButton>
        <StepContent>
          <Typography mb={4}>Recreational</Typography>
          <Typography variant="headline-smaller" mb={4}>
            Professional
          </Typography>
          <Typography>Cultural</Typography>
        </StepContent>
      </Step>
      <Step>
        <StepButton>
          <StepLabel StepIconComponent={StepIconComponent}>
            Verification
          </StepLabel>
        </StepButton>
      </Step>
    </Stepper>
  </Story>
</Canvas>

### Dark theme

<DarkThemeNotice />

<Canvas>
  <Story name="Dark theme" parameters={{ theme: "dark" }}>
    <>
      <Stepper activeStep={1} orientation="vertical">
        <Step completed>
          <StepButton>
            <StepLabel StepIconComponent={StepIconComponent}>
              Completed
            </StepLabel>
          </StepButton>
        </Step>
        <Step completed>
          <StepButton>
            <StepLabel StepIconComponent={StepIconComponent}>
              Completed, active
            </StepLabel>
          </StepButton>
        </Step>
        <Step>
          <StepButton>
            <StepLabel StepIconComponent={StepIconComponent}>
              Disabled
            </StepLabel>
          </StepButton>
        </Step>
      </Stepper>
      <Box py={4} />
      <Stepper activeStep={1} orientation="vertical" nonLinear>
        <Step>
          <StepButton>
            <StepLabel error StepIconComponent={StepIconComponent}>
              Error
            </StepLabel>
          </StepButton>
        </Step>
        <Step>
          <StepButton>
            <StepLabel error StepIconComponent={StepIconComponent}>
              Error, active
            </StepLabel>
          </StepButton>
        </Step>
        <Step disabled>
          <StepButton>
            <StepLabel StepIconComponent={StepIconComponent}>
              Disabled
            </StepLabel>
          </StepButton>
        </Step>
      </Stepper>
      <Box py={4} />
      <Stepper activeStep={1} orientation="vertical" nonLinear>
        <Step>
          <StepButton>
            <StepLabel
              StepIconComponent={(props) => (
                <StepIconComponent {...props} icon={null} />
              )}
            >
              Incomplete
            </StepLabel>
          </StepButton>
        </Step>
        <Step>
          <StepButton>
            <StepLabel
              StepIconComponent={(props) => (
                <StepIconComponent {...props} icon={null} />
              )}
            >
              Incomplete, active
            </StepLabel>
          </StepButton>
        </Step>
        <Step disabled>
          <StepButton>
            <StepLabel
              StepIconComponent={(props) => (
                <StepIconComponent {...props} icon={null} />
              )}
            >
              Disabled
            </StepLabel>
          </StepButton>
        </Step>
      </Stepper>
      <Box py={4} />
      <Stepper activeStep={1} orientation="vertical" nonLinear>
        <Step>
          <StepButton>
            <StepLabel StepIconComponent={StepIconComponent}>
              Incomplete (numeric)
            </StepLabel>
          </StepButton>
        </Step>
        <Step>
          <StepButton>
            <StepLabel StepIconComponent={StepIconComponent}>
              Incomplete, active (numeric)
            </StepLabel>
          </StepButton>
        </Step>
        <Step disabled>
          <StepButton>
            <StepLabel StepIconComponent={StepIconComponent}>
              Disabled (numeric)
            </StepLabel>
          </StepButton>
        </Step>
      </Stepper>
    </>
  </Story>
</Canvas>
