import { Canvas, Meta, Story } from "@storybook/addon-docs";
import { name, peerDependencies, version } from "../../package.json";
import { within, userEvent } from "@storybook/testing-library";
import {
  ComponentTitle,
  VersionNotice,
  InstallationInstructions
} from "../../../docs/src/partials";
import IconButton from "@iccc/icon-button";
import ClickAwayListener from "@mui/material/ClickAwayListener";
import Flyout from "../flyout.js";
import Link from "@mui/material/Link";
import MoreIcon from "@iccc/icon/lib/build/icons/more";
import prettier from "prettier/standalone";
import prettierBabel from "prettier/parser-babel";
import SvgIcon from "@mui/material/SvgIcon";
import Typography from "@iccc/typography";

<Meta
  id="components/flyout-menu"
  title={"Digital HIG/Components/Flyout menu"}
  parameters={{
    docs: {
      source: {
        type: "code"
      },
      transformSource: (input) =>
        prettier.format(input, {
          parser: "babel",
          plugins: [prettierBabel]
        })
    }
  }}
/>

<ComponentTitle name="Flyout menu" status="Stable" />

<code>
  <VersionNotice packageName="flyout" version={version} />
</code>

Flyout menus temporarily show a list of actions or menu items on top of the interface when triggered.

For related design documentation, please see the [Digital HIG Figma UI Toolkit](https://www.figma.com/file/HDxfNz8r9nm08FzegCfHB8/flyout-menu?node-id=204%3A86118&t=yzyeJF2FUxSGv3c3-1).

For the initial engineering prototype, see the archived [Flyout menu prototype page](https://storybook.digital-help-stg.autodesk.com/iccc/prerelease/PR-659/index.html?path=/docs/components-flyout-menu--default-story).

## Installation

<InstallationInstructions
  componentImport="Flyout"
  name={name}
  peerDependencies={peerDependencies}
/>

## API

- For all supported MUI `<Tooltip />` props, see [Tooltip](https://mui.com/material-ui/api/tooltip/).

### Default

Wrapping Flyout component with [MUI Click-Away Listener](https://mui.com/base/react-click-away-listener/) will make the menu close by clicking anywhere in the screen.

<Canvas>
  <Story
    name="Default"
    play={async ({ canvasElement }) => {
      const canvas = within(canvasElement);
      const trigger = await canvas.getAllByRole("button");
      await trigger.forEach((trigger) => {
        userEvent.click(trigger);
      });
    }}
  >
    {() => {
      const [open, setOpen] = React.useState(false);
      const handleClose = () => {
        setOpen(false);
      };
      const toggle = () => {
        setOpen((prev) => !prev);
      };
      return (
        <ClickAwayListener onClickAway={handleClose}>
          <Flyout
            onClose={handleClose}
            open={open}
            menuItems={[
              { children: "Marble wall" },
              { children: "Volcano rock" },
              {
                children: "Kevlar carbon fibre",
                disabled: true
              },
              { children: "Dark marble" }
            ]}
          >
            <IconButton size="small" onClick={toggle} variant="text">
              <SvgIcon>
                <MoreIcon />
              </SvgIcon>
            </IconButton>
          </Flyout>
        </ClickAwayListener>
      );
    }}
  </Story>
</Canvas>

### Style: with beak

<Canvas>
  <Story
    name="Style: with beak"
    play={async ({ canvasElement }) => {
      const canvas = within(canvasElement);
      const trigger = await canvas.getAllByRole("button");
      await trigger.forEach((trigger) => {
        userEvent.click(trigger);
      });
    }}
  >
    {() => {
      const [open, setOpen] = React.useState(false);
      const handleClose = () => {
        setOpen(false);
      };
      const toggle = () => {
        setOpen((prev) => !prev);
      };
      return (
        <ClickAwayListener onClickAway={handleClose}>
          <Flyout
            arrow
            onClose={handleClose}
            open={open}
            menuItems={[
              { children: "Marble wall" },
              { children: "Volcano rock" },
              {
                children: "Kevlar carbon fibre",
                disabled: true
              },
              { children: "Dark marble" }
            ]}
          >
            <IconButton size="small" onClick={toggle} variant="text">
              <SvgIcon>
                <MoreIcon />
              </SvgIcon>
            </IconButton>
          </Flyout>
        </ClickAwayListener>
      );
    }}
  </Story>
</Canvas>

### Different trigger

Trigger set to MUI's `<Link/>` component.

<Canvas>
  <Story name="Different trigger">
    {() => {
      const [open, setOpen] = React.useState(false);
      const handleClose = () => {
        setOpen(false);
      };
      const toggle = () => {
        setOpen((prev) => !prev);
      };
      return (
        <ClickAwayListener onClickAway={handleClose}>
          <Flyout
            onClose={handleClose}
            open={open}
            menuItems={[
              { children: "Marble wall" },
              { children: "Volcano rock" },
              {
                children: "Kevlar carbon fibre",
                disabled: true
              },
              { children: "Dark marble" }
            ]}
          >
            <Typography>
              <Link onClick={toggle}>trigger</Link>
            </Typography>
          </Flyout>
        </ClickAwayListener>
      );
    }}
  </Story>
</Canvas>
