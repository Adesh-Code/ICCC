import { Canvas, Meta, Story } from "@storybook/addon-docs";
import {
  ComponentTitle,
  InstallationInstructions,
  VariantRangeNotice,
  VersionNotice
} from "../../../docs/src/partials";
import { name, peerDependencies, version } from "../../package.json";
import Box from "@mui/material/Box";
import FormControl from "@mui/material/FormControl";
import ListSubheader from "@mui/material/ListSubheader";
import MenuItem from "@mui/material/MenuItem";
import OptionContent from "../option-content";
import prettier from "prettier/standalone";
import prettierBabel from "prettier/parser-babel";
import Select from "../select";
import SvgComplete from "@iccc/icon/lib/build/icons/complete";
import SvgGlobe from "@iccc/icon/lib/build/icons/globe";
import SvgIcon from "@mui/material/SvgIcon";
import SvgLink from "@iccc/icon/lib/build/icons/link";
import SvgProfile from "@iccc/icon/lib/build/icons/profile";
import SvgVisible from "@iccc/icon/lib/build/icons/visible";
import Typography from "@iccc/typography";
import InputLabel from "@mui/material/InputLabel";
import FormHelperText from "@mui/material/FormHelperText";
import ErrorIcon from "@iccc/icon/lib/build/display-icons/error";
import CompleteIcon from "@iccc/icon/lib/build/display-icons/complete";

export const defaultOptions = [
  { children: "Beton brut", value: 1 },
  { children: "Carbon-negative rubber", value: 2 },
  { children: "Dark marble", value: 3 },
  { children: "Durable bamboo", value: 4 },
  { children: "Frosted glass", value: 5 }
];

<Meta
  title="Digital HIG/Components/Select"
  id="components/select"
  parameters={{
    docs: {
      source: {
        type: "code"
      },
      transformSource: (input) =>
        prettier.format(input, {
          parser: "babel",
          plugins: [prettierBabel]
        })
    }
  }}
/>

<ComponentTitle name="Select" status="Stable" />

<code>
  <VersionNotice packageName="select" version={version} />
</code>

The Select component is a wrapper around the [MUI `<Select>` component](https://mui.com/material-ui/react-select/), with Digital HIG defaults.
Additional messaging around the Select component is handled using the [Digital HIG `<FormControl>` component](/docs/components-form-control--api).

For related design documentation, please see the [Digital HIG Figma UI Toolkit](https://www.figma.com/file/Eks986gkqncHjkLnwQjO7g/iccc-sticker-sheets?node-id=4203%3A282330&t=iL4WgXwqDMZvxUAw-1).

## Installation

<InstallationInstructions
  componentImport="Select"
  name={name}
  peerDependencies={peerDependencies}
/>

## API

- For all supported MUI `<Select />` props, see [Select API](https://mui.com/material-ui/react-select/).
- For all supported MUI `<FormControl />` props, see [FormControl API](https://mui.com/material-ui/api/form-control/).
- For all supported MUI `<FormHelperText/>` props, see [FormHelperText API](https://mui.com/material-ui/api/form-helper-text/).
- For all supported MUI `<InputLabel />` props, see [InputLabel API](https://mui.com/material-ui/api/input-label/).

## Select variants

<VariantRangeNotice />

### Style: default

A default select element, which stretches to fill its containing element. It includes props passed into the `FormControl` wrapper, with sufficient selectable items to illustrate overflow behavior and line wrapping.

<Canvas>
  <Story name="Style: default">
    {() => {
      const [value, setValue] = React.useState(20);
      const handleChange = (event) => {
        setValue(event.target.value);
      };
      return (
        <FormControl fullWidth>
          <InputLabel htmlFor="select-default">
            Select label
            <Typography variant="smallprint" component="span">
              (optional)
            </Typography>
          </InputLabel>
          <Select
            defaultValue={value}
            id="select-default"
            onChange={handleChange}
            options={defaultOptions.concat([
              { children: "Ten", value: 10 },
              { children: "Eleven", value: 11 },
              { children: "Twelve", value: 12 },
              { children: "Thirteen", value: 13 },
              { children: "Fourteen", value: 14 },
              { children: "Fifteen", value: 15 },
              { children: "Sixteen", value: 16 },
              { children: "Seventeen", value: 17 },
              { children: "Eighteen", value: 18 },
              { children: "Nineteen", value: 19 },
              { children: "Twenty", value: 20 }
            ])}
            value={value}
          />
          <FormHelperText>Helper text</FormHelperText>
        </FormControl>
      );
    }}
  </Story>
</Canvas>

### Style: quiet

The same select element, with "quiet" styling applied.

<Canvas>
  <Story name="Style: quiet">
    {() => {
      const [value, setValue] = React.useState(2);
      const handleChange = (event) => {
        setValue(event.target.value);
      };
      return (
        <FormControl variant="filled">
          <InputLabel htmlFor="select-quiet">
            Select label
            <Typography variant="smallprint" component="span">
              (optional)
            </Typography>
          </InputLabel>
          <Select
            defaultValue={value}
            onChange={handleChange}
            options={defaultOptions}
            value={value}
            id="select-quiet"
          />
          <FormHelperText>Helper text</FormHelperText>
        </FormControl>
      );
    }}
  </Story>
</Canvas>

### Placeholder text

Use the MUI prop `displayEmpty` with an option that has an an empty value to display placeholder text when no item has been selected.

<Canvas>
  <Story name="Placeholder text">
    {() => {
      const [value, setValue] = React.useState("");
      const handleChange = (event) => {
        setValue(event.target.value);
      };
      return (
        <FormControl fullWidth>
          <InputLabel htmlFor="select-id-placeholder">
            Placeholder text
          </InputLabel>
          <Select
            defaultValue={value}
            displayEmpty
            id="select-id-placeholder"
            onChange={handleChange}
            options={[{ children: <em>Select...</em>, value: "" }].concat(
              defaultOptions
            )}
          />
        </FormControl>
      );
    }}
  </Story>
</Canvas>

### Rich options

Any component composition can be passed to the `options` prop, which can be used to populate the menu with rich options. The `renderValue` MUI prop can be used to render the label.

<Canvas>
  <Story
    name="Rich options"
    parameters={{
      docs: {
        source: {
          type: "code"
        }
      }
    }}
  >
    {() => {
      const [value, setValue] = React.useState(3);
      const handleChange = (event) => {
        setValue(event.target.value);
      };
      const options = [
        {
          children: (
            <Box display="flex">
              <Box pr={2}>
                <SvgIcon>
                  <SvgVisible />
                </SvgIcon>
              </Box>
              <Box flexGrow={1} pr={2}>
                <Typography
                  variant="body-copy-medium"
                  color="ink-on-background"
                >
                  Mauris senectus rhoncus
                </Typography>
                <Typography
                  variant="body-copy-small"
                  color="ink-on-background-60"
                >
                  Mi tristique cursus
                </Typography>
              </Box>
              <Box>
                <Typography variant="caption" color="ink-on-background-60">
                  24k
                </Typography>
              </Box>
            </Box>
          ),
          value: 1,
          label: "Mauris senectus rhoncus"
        },
        {
          children: (
            <Box display="flex">
              <Box pr={2}>
                <SvgIcon>
                  <SvgGlobe />
                </SvgIcon>
              </Box>
              <Box flexGrow={1} pr={1}>
                <Typography
                  variant="body-copy-medium"
                  color="ink-on-background"
                >
                  Vulputate sem venenatis
                </Typography>
                <Typography
                  variant="body-copy-small"
                  color="ink-on-background-60"
                >
                  Ultricies est sagittis
                </Typography>
              </Box>
              <Box>
                <Typography variant="caption" color="ink-on-background-60">
                  17k
                </Typography>
              </Box>
            </Box>
          ),
          value: 2,
          label: "Vulputate sem venenatis"
        },
        {
          children: (
            <Box display="flex">
              <Box pr={2}>
                <SvgIcon>
                  <SvgProfile />
                </SvgIcon>
              </Box>
              <Box flexGrow={1} pr={1}>
                <Typography
                  variant="body-copy-medium"
                  color="ink-on-background"
                >
                  Rich options
                </Typography>
                <Typography
                  variant="body-copy-small"
                  color="ink-on-background-60"
                >
                  Nibh vulputate nec
                </Typography>
              </Box>
              <Box>
                <Typography variant="caption" color="ink-on-background-60">
                  131k
                </Typography>
              </Box>
            </Box>
          ),
          value: 3,
          label: "Rich options"
        },
        {
          children: (
            <Box display="flex">
              <Box pr={2}>
                <SvgIcon>
                  <SvgLink />
                </SvgIcon>
              </Box>
              <Box flexGrow={1} pr={1}>
                <Typography
                  variant="body-copy-medium"
                  color="ink-on-background"
                >
                  Pulvinar facilisis felis
                </Typography>
                <Typography
                  variant="body-copy-small"
                  color="ink-on-background-60"
                >
                  Vulputate nibh neque
                </Typography>
              </Box>
              <Box>
                <Typography variant="caption" color="ink-on-background-60">
                  1.5k
                </Typography>
              </Box>
            </Box>
          ),
          value: 4,
          label: "Pulvinar facilisis felis"
        },
        {
          children: (
            <Box display="flex">
              <Box pr={2}>
                <SvgIcon>
                  <SvgComplete />
                </SvgIcon>
              </Box>
              <Box flexGrow={1} pr={1}>
                <Typography
                  variant="body-copy-medium"
                  color="ink-on-background"
                >
                  Enim faucibus adipiscing
                </Typography>
                <Typography
                  variant="body-copy-small"
                  color="ink-on-background-60"
                >
                  Mi tristique cursus
                </Typography>
              </Box>
              <Box>
                <Typography variant="caption" color="ink-on-background-60">
                  440k
                </Typography>
              </Box>
            </Box>
          ),
          value: 5,
          label: "Enim faucibus adipiscing"
        }
      ];
      const renderValue = (selected) => {
        const selectedOption = options.find(
          (option) => option.value === selected
        );
        return selectedOption ? selectedOption.label : "";
      };
      return (
        <FormControl fullWidth>
          <InputLabel htmlFor="select-rich-options">
            Select label
            <Typography variant="smallprint" component="span">
              (optional)
            </Typography>
          </InputLabel>
          <Select
            id="select-rich-options"
            defaultValue={value}
            onChange={handleChange}
            options={options}
            value={value}
            renderValue={renderValue}
          />
          <FormHelperText>Helper text</FormHelperText>
        </FormControl>
      );
    }}
  </Story>
</Canvas>

### Width

A fixed width can be prescribed using the `width` prop. This affects the width of both the select and the dropdown. **Note:** Percentage values are not supported.

<Canvas>
  <Story name="Width">
    {() => {
      const [value, setValue] = React.useState(2);
      const handleChange = (event) => {
        setValue(event.target.value);
      };
      return (
        <>
          <FormControl>
            <InputLabel htmlFor="select-width-px">
              Width
              <Typography variant="smallprint" component="span">
                (px)
              </Typography>
            </InputLabel>
            <Select
              defaultValue={value}
              id="select-width-px"
              onChange={handleChange}
              options={defaultOptions.concat([
                {
                  children:
                    "Three point one four one five nine two six five three five eight nine seven nine three",
                  value: 6
                }
              ])}
              value={value}
              width="200px"
            />
          </FormControl>
          <Box py={3} />
          <FormControl>
            <InputLabel htmlFor="select-width-rem">
              Width
              <Typography variant="smallprint" component="span">
                (rem)
              </Typography>
            </InputLabel>
            <Select
              defaultValue={value}
              id="select-witdh-rem"
              onChange={handleChange}
              options={defaultOptions.concat([
                {
                  children:
                    "Three point one four one five nine two six five three five eight nine seven nine three",
                  value: 6
                }
              ])}
              value={value}
              width="10rem"
            />
          </FormControl>
        </>
      );
    }}
  </Story>
</Canvas>

### Multi-select

Please see the [combobox component](/docs/components-combobox--multi-select-fixed#multi-select).

## States

### Error

Error state for default and quiet variants.

<Canvas>
  <Story name="Error">
    {() => {
      const [value, setValue] = React.useState(2);
      const handleChange = (event) => {
        setValue(event.target.value);
      };
      return (
        <>
          <FormControl error fullWidth>
            <InputLabel htmlFor="select-error">Error</InputLabel>
            <Select
              defaultValue={value}
              id="select-error"
              onChange={handleChange}
              options={defaultOptions}
              value={value}
              error
            />
            <FormHelperText>
              <SvgIcon>
                <ErrorIcon />
              </SvgIcon>
              Error message
            </FormHelperText>
          </FormControl>
          <Box py={3} />
          <FormControl error variant="filled">
            <InputLabel htmlFor="select-error-quiet">Error</InputLabel>
            <Select
              defaultValue={value}
              id="select-error-quiet"
              onChange={handleChange}
              options={defaultOptions}
              value={value}
              error
            />
            <FormHelperText>
              <SvgIcon>
                <ErrorIcon />
              </SvgIcon>
              Error message
            </FormHelperText>
          </FormControl>
        </>
      );
    }}
  </Story>
</Canvas>

### Success

<Canvas>
  <Story name="Success">
    {() => {
      const [value, setValue] = React.useState(2);
      const handleChange = (event) => {
        setValue(event.target.value);
      };
      return (
        <FormControl fullWidth color="success">
          <InputLabel htmlFor="select-success">Success</InputLabel>
          <Select
            defaultValue={value}
            id="select-success"
            onChange={handleChange}
            options={defaultOptions}
            value={value}
          />
          <FormHelperText>
            <SvgIcon>
              <CompleteIcon />
            </SvgIcon>
            Success message
          </FormHelperText>
        </FormControl>
      );
    }}
  </Story>
</Canvas>

### Disabled

<Canvas>
  <Story name="Disabled">
    {() => {
      const [value, setValue] = React.useState(2);
      const handleChange = (event) => {
        setValue(event.target.value);
      };
      return (
        <FormControl fullWidth disabled>
          <InputLabel htmlFor="select-disabled">Disabled</InputLabel>
          <Select
            defaultValue={value}
            id="select-disabled"
            onChange={handleChange}
            options={defaultOptions}
            value={value}
            disabled
          />
          <FormHelperText>Disabled field</FormHelperText>
        </FormControl>
      );
    }}
  </Story>
</Canvas>

### Menu item composition

Custom menu composition can be achieved by using MUI `<MenuItem />` directly.

**Please note**: [As per MUI documentation](https://mui.com/material-ui/api/select/#props), `<MenuItem />` elements must be direct descendants of `<Select />`.

For this reason, if you want to preserve the default Digital HIG presentation which adds a checkmark icon denoting the currently selected option, you can use the special `<OptionContent />` component.

<Canvas>
  <Story name="Menu item composition">
    {() => {
      const [value, setValue] = React.useState(10);
      const handleChange = (event) => {
        setValue(event.target.value);
      };
      return (
        <FormControl>
          <InputLabel htmlFor="select-menu-item">Choose an option</InputLabel>
          <Select
            defaultValue={value}
            onChange={handleChange}
            value={value}
            id="select-menu-item"
          >
            <MenuItem value={10}>
              <OptionContent isSelected={value === 10}>Ten</OptionContent>
            </MenuItem>
            <MenuItem value={20}>
              <OptionContent isSelected={value === 20}>Twenty</OptionContent>
            </MenuItem>
            <MenuItem value={30}>
              <OptionContent isSelected={value === 30}>Thirty</OptionContent>
            </MenuItem>
          </Select>
        </FormControl>
      );
    }}
  </Story>
</Canvas>

### Native

The `native` prop can be used if a native select element is desired. Native elements such as as `<optgroup>` and `<option>` can then be added as children.

<Canvas>
  <Story name="Native">
    <FormControl fullWidth>
      <InputLabel htmlFor="select-native">
        Select label
        <Typography variant="smallprint" component="span">
          (optional)
        </Typography>
      </InputLabel>
      <Select id="select-native" native>
        <optgroup>
          <option value="1">One</option>
          <option value="2">Two</option>
          <option value="3">Three</option>
        </optgroup>
      </Select>
      <FormHelperText>Helper text</FormHelperText>
    </FormControl>
  </Story>
</Canvas>

### Categories

Use the MUI `<ListSubheader />` element for category titles.

For all supported MUI `<ListSubheader />` props, see [ListSubheader API](https://mui.com/material-ui/api/list-subheader/#main-content).

<Canvas>
  <Story name="Categories">
    {() => {
      const [value, setValue] = React.useState(10);
      const handleChange = (event) => {
        setValue(event.target.value);
      };
      return (
        <FormControl>
          <InputLabel htmlFor="select-categories">Choose an option</InputLabel>
          <Select
            defaultValue={value}
            onChange={handleChange}
            value={value}
            id="select-categories"
          >
            <ListSubheader>Odd Category</ListSubheader>
            <MenuItem value={10}>
              <OptionContent isSelected={value === 10}>Ten</OptionContent>
            </MenuItem>
            <MenuItem value={20}>
              <OptionContent isSelected={value === 20}>Twenty</OptionContent>
            </MenuItem>
            <MenuItem value={30}>
              <OptionContent isSelected={value === 30}>Thirty</OptionContent>
            </MenuItem>
            <ListSubheader>Even Category</ListSubheader>
            <MenuItem value={1}>
              <OptionContent isSelected={value === 1}>One</OptionContent>
            </MenuItem>
            <MenuItem value={3}>
              <OptionContent isSelected={value === 3}>Three</OptionContent>
            </MenuItem>
            <MenuItem value={5}>
              <OptionContent isSelected={value === 5}>Five</OptionContent>
            </MenuItem>
          </Select>
        </FormControl>
      );
    }}
  </Story>
</Canvas>

### Dark theme

<Canvas>
  <Story
    name="Dark theme"
    parameters={{
      theme: "dark"
    }}
  >
    {() => {
      const [value, setValue] = React.useState(2);
      const handleChange = (event) => {
        setValue(event.target.value);
      };
      return (
        <>
          <FormControl fullWidth>
            <InputLabel htmlFor="select-dark">Dark</InputLabel>
            <Select
              defaultValue={value}
              id="select-dark"
              onChange={handleChange}
              options={defaultOptions}
              value={value}
            />
            <FormHelperText>Dark theme</FormHelperText>
          </FormControl>
          <Box my={3} />
          <FormControl variant="filled">
            <InputLabel htmlFor="select-dark-quiet">Dark</InputLabel>
            <Select
              defaultValue={value}
              id="select-dark-quiet"
              onChange={handleChange}
              options={defaultOptions}
              value={value}
            />
            <FormHelperText>Dark theme</FormHelperText>
          </FormControl>
        </>
      );
    }}
  </Story>
</Canvas>

## Accessibility

For optimal accessibility, use a unique ID for both the `FormControl` and `Select` elements, and utilize the `helperText` prop with the `FormControl` element.
