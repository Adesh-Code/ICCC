import { useState } from "react";
import { ArgsTable, Canvas, Meta, Story } from "@storybook/addon-docs";
import { componentArgs } from "../constants";
import {
  ComponentTitle,
  DarkThemeNotice,
  InstallationInstructions,
  VariantRangeNotice,
  VersionNotice
} from "../../../docs/src/partials";
import { name, peerDependencies, version } from "../../package.json";
import { within, userEvent } from "@storybook/testing-library";
import Box from "@mui/material/Box";
import Button from "@mui/material/Button";
import CircularProgress from "@iccc/circular-progress";
import CompleteIcon from "@iccc/icon/lib/build/display-icons/complete";
import InfoIcon from "@iccc/icon/lib/build/display-icons/info";
import Modal from "../modal";
import prettier from "prettier/standalone";
import prettierBabel from "prettier/parser-babel";
import Typography from "@iccc/typography";

<Meta
  args={Modal.defaultProps}
  argTypes={componentArgs}
  component={Modal}
  id="components/modal"
  title="Digital HIG/Components/Modal"
  parameters={{
    docs: {
      source: {
        type: "code"
      },
      transformSource: (input) =>
        prettier.format(input, {
          parser: "babel",
          plugins: [prettierBabel]
        })
    }
  }}
/>

<ComponentTitle name="Modal" status="Stable" />

<code>
  <VersionNotice packageName="modal" version={version} />
</code>

The Modal component is a thin wrapper around MUI [`<Dialog>`](https://mui.com/material-ui/react-dialog/), with Digital HIG defaults.

For related design documentation, please see the [Digital HIG Figma UI Toolkit](https://www.figma.com/file/Eks986gkqncHjkLnwQjO7g/iccc-sticker-sheets?node-id=4203%3A273565&t=iL4WgXwqDMZvxUAw-1).

## Installation

<InstallationInstructions
  componentImport="Modal"
  name={name}
  peerDependencies={peerDependencies}
/>

## API

For all supported MUI `<Dialog />` props, see [Dialog API](https://mui.com/material-ui/api/dialog/).

<Canvas>
  <Story
    name="API"
    argTypes={componentArgs}
    args={{
      actions: true
    }}
  >
    {({ actions, buttonTitle, type, ...otherProps }) => {
      const [open, setOpen] = useState(false);
      const closeModal = () => setOpen(false);
      const openModal = () => setOpen(true);
      return (
        <>
          <Button onClick={openModal}>
            {buttonTitle || "Click to open modal"}
          </Button>
          <Modal
            {...otherProps}
            type={type}
            handleClose={closeModal}
            open={open}
            title={`Modal (type ${type})`}
            AlertIcon={InfoIcon}
            actions={
              actions && (
                <Box>
                  <Box component="span" mr={5}>
                    <Button variant="text" onClick={closeModal}>
                      Secondary
                    </Button>
                  </Box>
                  <Button onClick={closeModal}>Primary action</Button>
                </Box>
              )
            }
            content={
              type === "lightbox" ? (
                <img
                  alt="placeholder"
                  src="https://swc.autodesk.com/pharmacopeia/img/placeholders/960x640.png"
                />
              ) : (
                <Typography>
                  Feugiat elementum ut amet in. Commodo, placerat sagittis,
                  laoreet sagittis arcu id. Fringilla sit amet a fermentum lacus
                  mi mauris lectus. Ipsum posuere eu velit id malesuada volutpat
                  sapien montes, nisl. Quisque tortor diam ut eu tempor
                  tincidunt mi. Etiam lacinia massa molestie ornare cursus enim.
                  Aliquet dignissim mauris, diam aliquam. Odio at eros,
                  parturient felis dui feugiat at.
                </Typography>
              )
            }
          />
        </>
      );
    }}
  </Story>
</Canvas>

<ArgsTable story="API" />

## Modal variants

<VariantRangeNotice />

### Type

#### Lightbox

The `lightbox` type is meant for presenting media like images or video, using the space the viewport offers or the space the image/video needs, depending on which one is smaller. The close button is always located on the outside of the modal for this type.

<Canvas>
  <Story name="Type: Lightbox">
    {() => {
      const [open, setOpen] = useState(false);
      const closeModal = () => setOpen(false);
      const openModal = () => setOpen(true);
      return (
        <>
          <Button onClick={openModal}>Click to open modal</Button>
          <Modal
            handleClose={closeModal}
            open={open}
            type="lightbox"
            caption={
              <>
                <Typography variant="caption">
                  This is a placeholder caption.
                </Typography>
                <Typography variant="smallprint">
                  Image credit: Â© 2022 Faucibus imperdiet integer leo nunc urna
                  et gravida lobortis quam.
                </Typography>
              </>
            }
            content={
              <img
                alt="placeholder"
                src="https://swc.autodesk.com/pharmacopeia/img/placeholders/960x640.png"
              />
            }
            maxWidth={false}
          />
        </>
      );
    }}
  </Story>
</Canvas>

#### Alert

The `alert` type is a more rigid version of the default modal, with a predefined content layout. It accepts an icon from the "display-icons" set to be passed into the modal's body using the `AlertIcon` prop. The title and content are pre-styled.

```jsx
import CompleteIcon from "@iccc/icon/lib/build/display-icons/complete";
import InfoIcon from "@iccc/icon/lib/build/display-icons/info";
```

<Canvas>
  <Story name="Type: Alert">
    {() => {
      const [openCompleteIcon, setOpenCompleteIcon] = useState(false);
      const closeCompleteIconModal = () => setOpenCompleteIcon(false);
      const openCompleteIconModal = () => setOpenCompleteIcon(true);
      const [openInfoIcon, setOpenInfoIcon] = useState(false);
      const closeInfoIconModal = () => setOpenInfoIcon(false);
      const openInfoIconModal = () => setOpenInfoIcon(true);
      return (
        <>
          <Button onClick={openCompleteIconModal}>
            Click to open modal with CompleteIcon
          </Button>
          <Box my={4} />
          <Button onClick={openInfoIconModal}>
            Click to open modal with InfoIcon
          </Button>
          <Modal
            handleClose={closeCompleteIconModal}
            open={openCompleteIcon}
            title="Alert with CompleteIcon"
            type="alert"
            actions={
              <Box>
                <Box component="span" mr={5}>
                  <Button variant="text" onClick={closeCompleteIconModal}>
                    Secondary
                  </Button>
                </Box>
                <Button onClick={closeCompleteIconModal}>Primary action</Button>
              </Box>
            }
            content={
              <Typography>
                Mollis blandit etiam faucibus porta lectus. Ultricies venenatis
                ullamcorper tristique dignissim faucibus viverra semper
                elementum est
              </Typography>
            }
            AlertIcon={CompleteIcon}
          />
          <Modal
            handleClose={closeInfoIconModal}
            open={openInfoIcon}
            title="Alert with InfoIcon"
            type="alert"
            actions={
              <Box>
                <Box component="span" mr={5}>
                  <Button variant="text" onClick={closeInfoIconModal}>
                    Secondary
                  </Button>
                </Box>
                <Button onClick={closeInfoIconModal}>Primary action</Button>
              </Box>
            }
            content={
              <Typography>
                Mollis blandit etiam faucibus porta lectus. Ultricies venenatis
                ullamcorper tristique dignissim faucibus viverra semper
                elementum est
              </Typography>
            }
            AlertIcon={InfoIcon}
          />
        </>
      );
    }}
  </Story>
</Canvas>

#### Modal

The `modal` type can be used to create overlays that do not fall into the categories listed above. Use this variant to request information from users.

<Canvas>
  <Story name="Type: Modal">
    {() => {
      const [open, setOpen] = useState(false);
      const closeModal = () => setOpen(false);
      const openModal = () => setOpen(true);
      return (
        <>
          <Button onClick={openModal}>Click to open modal</Button>
          <Modal
            handleClose={closeModal}
            open={open}
            actions={
              <Box>
                <Box component="span" mr={5}>
                  <Button variant="text" onClick={closeModal}>
                    Secondary
                  </Button>
                </Box>
                <Button onClick={closeModal}>Primary action</Button>
              </Box>
            }
            content={
              <Typography>
                Feugiat elementum ut amet in. Commodo, placerat sagittis,
                laoreet sagittis arcu id. Fringilla sit amet a fermentum lacus
                mi mauris lectus. Ipsum posuere eu velit id malesuada volutpat
                sapien montes, nisl. Quisque tortor diam ut eu tempor tincidunt
                mi. Etiam lacinia massa molestie ornare cursus enim. Aliquet
                dignissim mauris, diam aliquam. Odio at eros, parturient felis
                dui feugiat at.
              </Typography>
            }
            title="Modal"
          />
        </>
      );
    }}
  </Story>
</Canvas>

### Subdivision

The `subdivision` style variant displays a modal with dividers separating the title and actions from the main content.

<Canvas>
  <Story name="Subdivision">
    {() => {
      const [open, setOpen] = useState(false);
      const closeModal = () => setOpen(false);
      const openModal = () => setOpen(true);
      return (
        <>
          <Button onClick={openModal}>Click to open modal</Button>
          <Modal
            handleClose={closeModal}
            open={open}
            actions={
              <Box>
                <Box component="span" mr={5}>
                  <Button variant="text" onClick={closeModal}>
                    Secondary
                  </Button>
                </Box>
                <Button onClick={closeModal}>Primary action</Button>
              </Box>
            }
            content={
              <Typography>
                Feugiat elementum ut amet in. Commodo, placerat sagittis,
                laoreet sagittis arcu id. Fringilla sit amet a fermentum lacus
                mi mauris lectus. Ipsum posuere eu velit id malesuada volutpat
                sapien montes, nisl. Quisque tortor diam ut eu tempor tincidunt
                mi. Etiam lacinia massa molestie ornare cursus enim. Aliquet
                dignissim mauris, diam aliquam. Odio at eros, parturient felis
                dui feugiat at.
              </Typography>
            }
            styleVariant="subdivision"
            title="Subdivision"
          />
        </>
      );
    }}
  </Story>
</Canvas>

### Hide title

The title area can be hidden by not providing a value to both the `title` or `displayLogo` props.

<Canvas>
  <Story name="Hide title">
    {() => {
      const [open, setOpen] = useState(false);
      const closeModal = () => setOpen(false);
      const openModal = () => setOpen(true);
      return (
        <>
          <Button onClick={openModal}>Click to open modal</Button>
          <Modal
            handleClose={closeModal}
            open={open}
            content={
              <Box display="flex" justifyContent="center" width="342px">
                <CircularProgress size="large" />
              </Box>
            }
          />
        </>
      );
    }}
  </Story>
</Canvas>

### Hide actions

The action area can be hidden by not providing a value to the `actions` prop.

<Canvas>
  <Story name="Hide actions">
    {() => {
      const [open, setOpen] = useState(false);
      const closeModal = () => setOpen(false);
      const openModal = () => setOpen(true);
      return (
        <>
          <Button onClick={openModal}>Click to open modal</Button>
          <Modal
            handleClose={closeModal}
            open={open}
            content={
              <Box display="flex" justifyContent="center" width="342px">
                <CircularProgress size="large" />
              </Box>
            }
            title="Hide actions"
          />
        </>
      );
    }}
  </Story>
</Canvas>

### Scroll whole content

To enable scrolling for the entire modal, use the `DialogContentProps` prop to override the vertical overflow of the `DialogContent` component.

<Canvas>
  <Story name="Scroll whole content">
    {() => {
      const [open, setOpen] = useState(false);
      const closeModal = () => setOpen(false);
      const openModal = () => setOpen(true);
      return (
        <>
          <Button onClick={openModal}>Click to open modal</Button>
          <Modal
            handleClose={closeModal}
            open={open}
            actions={
              <Box>
                <Box component="span" mr={5}>
                  <Button variant="text" onClick={closeModal}>
                    Secondary
                  </Button>
                </Box>
                <Button onClick={closeModal}>Primary action</Button>
              </Box>
            }
            title="Scroll whole content"
            DialogContentProps={{ style: { overflowY: "unset" } }}
            content={
              <Typography>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                Vestibulum vitae enim vestibulum, sodales ex et, ultricies
                felis. Proin et mi quis tellus placerat eleifend. Nam in magna
                lectus. Sed placerat, urna eget volutpat porta, urna erat
                imperdiet odio, nec facilisis erat nisi quis nulla. Donec vel
                consequat nisl. Nullam laoreet nunc augue, et vulputate turpis
                euismod volutpat. Nullam dui lectus, pulvinar ac odio sit amet,
                pellentesque pharetra massa. Nullam neque dolor, bibendum ac
                eros elementum, faucibus vulputate ex. Cras ultrices nec nisi et
                pellentesque. Nam a sollicitudin sapien. Etiam semper magna ac
                turpis efficitur, quis aliquet diam condimentum. Nulla vitae
                bibendum sapien. Vestibulum in vehicula felis, ultricies viverra
                dui. Nullam vehicula lorem vitae ullamcorper tristique. Donec
                elementum facilisis imperdiet. Nullam nec varius risus, at
                suscipit nisl. Fusce ut nibh facilisis, congue libero eu,
                posuere nibh. Cras eu condimentum lectus. In dapibus dapibus mi,
                ac venenatis dui rutrum quis. Vivamus cursus mattis lorem,
                ultrices semper ipsum mattis sed. Mauris gravida convallis
                placerat. Sed sed tellus nec justo accumsan convallis.Curabitur
                sed faucibus quam. Quisque gravida justo at iaculis blandit.
                Pellentesque faucibus posuere lectus, vel sagittis eros cursus
                sed. In dictum ornare facilisis. Etiam vel urna imperdiet tortor
                placerat efficitur eu sed justo. Nulla id sagittis magna. Donec
                semper eros et odio aliquet, ac euismod dolor accumsan. Donec at
                enim blandit neque auctor viverra eu sed felis. Phasellus
                dapibus eros sit amet massa pulvinar, et interdum nibh
                vestibulum. Quisque mattis, ante in luctus dictum, nulla eros
                interdum turpis, id fringilla neque nisi quis diam. Donec at
                tortor vel sapien vulputate vulputate. Nam mattis risus et
                congue volutpat. Aliquam finibus commodo quam a porta. Proin
                ligula nunc, tincidunt at purus vitae, viverra condimentum quam.
                Suspendisse elit magna, volutpat et eleifend at, consectetur vel
                nisl. Sed pharetra, nunc ac vestibulum sollicitudin, sapien nunc
                rutrum arcu, sed mollis leo dui ac odio. Fusce sed lectus sit
                amet ante porta bibendum. Proin id sem congue, viverra metus sit
                amet, pellentesque nibh. Curabitur non massa diam. In hac
                habitasse platea dictumst. Etiam feugiat urna nec nisl
                sollicitudin, nec consectetur nisl faucibus. In pretium eu nisl
                et ultrices. Curabitur ex magna, facilisis vel nulla vitae,
                lobortis viverra urna. Aliquam erat volutpat. Curabitur dapibus
                cursus sapien, ut mollis arcu molestie ut. Vivamus ac sem magna.
                Suspendisse efficitur luctus nibh, eu tincidunt eros sodales
                vitae. Vivamus blandit eu velit quis porta. Vivamus quis
                pulvinar lorem, id blandit purus. Etiam efficitur eros
                scelerisque mollis tempor. Mauris quis pretium arcu. Donec
                feugiat dolor lobortis, fringilla leo lacinia, convallis dui.
                Sed lacinia orci sed lorem sagittis euismod. Curabitur
                vestibulum eleifend neque sit amet dignissim. Etiam sit amet
                nisl vel odio sollicitudin ullamcorper. Nullam varius justo eget
                lobortis placerat. In a nibh non ante rutrum fringilla ut luctus
                felis. Nulla porttitor tincidunt turpis, id varius eros dictum
                eu. Nam at dignissim ante. In ac efficitur turpis. Quisque
                tempus erat ut justo tincidunt, sit amet euismod diam pretium.
              </Typography>
            }
          />
        </>
      );
    }}
  </Story>
</Canvas>

### Dark theme

<DarkThemeNotice />

<Canvas>
  <Story
    name="Dark theme"
    parameters={{
      theme: "dark"
    }}
  >
    {() => {
      const [open, setOpen] = useState(false);
      const closeModal = () => setOpen(false);
      const openModal = () => setOpen(true);
      return (
        <>
          <Button onClick={openModal}>Click to open modal</Button>
          <Modal
            handleClose={closeModal}
            open={open}
            title="Dark theme"
            content={
              <Typography>
                Feugiat elementum ut amet in. Commodo, placerat sagittis,
                laoreet sagittis arcu id. Fringilla sit amet a fermentum lacus
                mi mauris lectus. Ipsum posuere eu velit id malesuada volutpat
                sapien montes, nisl. Quisque tortor diam ut eu tempor tincidunt
                mi. Etiam lacinia massa molestie ornare cursus enim. Aliquet
                dignissim mauris, diam aliquam. Odio at eros, parturient felis
                dui feugiat at.
              </Typography>
            }
          />
        </>
      );
    }}
  </Story>
</Canvas>

## Accessibility

For more details about accessibility for modals, visit the [MUI Modal Accessibility section](https://mui.com/material-ui/react-modal/#accessibility).

<Canvas>
  <Story name="Accessibility">
    {() => {
      const [open, setOpen] = useState(false);
      const closeModal = () => setOpen(false);
      const openModal = () => setOpen(true);
      return (
        <>
          <Button onClick={openModal}>Click to open modal</Button>
          <Modal
            aria-describedby="dhig-modal-description"
            aria-labelledby="dhig-modal-title"
            handleClose={closeModal}
            open={open}
            title="Accessibility"
            content={
              <Typography>
                Feugiat elementum ut amet in. Commodo, placerat sagittis,
                laoreet sagittis arcu id. Fringilla sit amet a fermentum lacus
                mi mauris lectus. Ipsum posuere eu velit id malesuada volutpat
                sapien montes, nisl. Quisque tortor diam ut eu tempor tincidunt
                mi. Etiam lacinia massa molestie ornare cursus enim. Aliquet
                dignissim mauris, diam aliquam. Odio at eros, parturient felis
                dui feugiat at.
              </Typography>
            }
          />
        </>
      );
    }}
  </Story>
</Canvas>

<Canvas>
  <Story
    name="VR: interactions"
    play={async ({ canvasElement }) => {
      const canvas = within(canvasElement);
      const trigger = await canvas.getAllByRole("button");
      await trigger.forEach((trigger) => {
        userEvent.click(trigger);
      });
    }}
  >
    {() => {
      const [open, setOpen] = useState(false);
      const closeModal = () => setOpen(false);
      const openModal = () => setOpen(true);
      return (
        <>
          <Button onClick={openModal}>Click to open modal</Button>
          <Modal
            handleClose={closeModal}
            open={open}
            title="Modal with interaction"
            type="alert"
            content={
              <Typography>
                Mollis blandit etiam faucibus porta lectus. Ultricies venenatis
                ullamcorper tristique dignissim faucibus viverra semper
                elementum est
              </Typography>
            }
            actions={
              <Box>
                <Box component="span" mr={5}>
                  <Button variant="text" onClick={closeModal}>
                    Secondary
                  </Button>
                </Box>
                <Button onClick={closeModal}>Primary action</Button>
              </Box>
            }
            AlertIcon={CompleteIcon}
          />
        </>
      );
    }}
  </Story>
</Canvas>
