import { Meta } from "@storybook/addon-docs";

<Meta
  title="Digital HIG/Documentation/Contributing/Writing documentation"
  parameters={{
    viewMode: "docs",
    previewTabs: {
      canvas: { hidden: true }
    }
  }}
/>

# Writing documentation

Use this document as a guide to understand the best practices involved when documenting Digial HIG components using Storybook.

## Table of contents

- [Motivation](#motivation)
- [Storybook overview](#storybook-overview)
- [Setup](#setup)
- [Elements of a well-written story](#elements-of-a-well-written-story)
- [Useful links](#useful-links)

## Motivation

The purpose of this guide is to provide guidance on writing clear, consistent, and useful documentation in Storybook.

## Storybook overview

> Storybook [...] lives alongside your app. It provides an isolated iframe to render components without interference from app business logic and context. That helps you focus development on each variation of a component, including edge cases.
>
> In the past, you'd have to spin up the app, navigate to a page, and contort the UI into the right state. This is a huge waste of time and bogs down frontend development. With Storybook, you can skip all those steps and jump straight to working on a UI component in a specific state.

—[Why Storybook?](https://storybook.js.org/docs/react/why-storybook)

We follow this pattern in our project, creating a separate story for each Digital HIG component. Storybook allows us to supply props and mock data to illustrate the range of our component variants.

For example, the following image illustrates the prop table for the Button component, allowing us to easily simulate all 32 possible combinations of props:

<img
  src="./images/writing-documentation/001.png"
  alt="Digital HIG Button props on Storybook page"
  width={800}
/>

More information on implementation can be found below, in the [elements of a well-written story section](#elements-of-a-well-written-story).

## Setup

### Configuration

All our Storybook config files can be found at `./storybook`. In these files, we load the DHIG assets (icon sprites, fonts, and [global CSS](/docs/iccc-css-and-sass-utility-css-overview--page#add-via-cdn-link)), provide a custom theme, and configure the sidebar and addons. One of these addons is `@storybook/addon-a11y`, which helps us test accessibility features for each component. For more information, see our [accessibility docs](/docs/iccc-documentation-contributing-accessibility-implementation-and-validation--page#accessibility-automation).

### Theme

In order to render the Digital HIG design system correctly, library components need to be wrapped in a special type of component that provides a compatible theme. We call this component [ThemeMui](/docs/components-mui-theme--light-theme).

[From MUI documentation](https://mui.com/material-ui/customization/theming/):

> The theme specifies the color of the components, darkness of the surfaces, level of shadow, appropriate opacity of ink elements, etc.
>
> Themes let you apply a consistent tone to your app. It allows you to customize all design aspects of your project in order to meet the specific needs of your business or brand.

To streamline the Digital HIG documentation process, the [Digital HIG light theme](/docs/components-mui-theme--light-theme) is automatically injected for all stories, using Storybook configuration files. For example, this story will be correctly wrapped with ThemeMui:

```jsx
<Canvas>
  <Story name="Light theme button">
    <Button>Light theme button</Button>
  </Story>
</Canvas>
```

By default, components are wrapped with a light theme. If you need to wrap components with a [dark theme](/docs/components-mui-theme--dark-theme), you can use the `theme` parameter as follows:

```jsx
<Canvas>
  <Story name="Dark theme button" parameters={{ theme: "dark" }}>
    <Button>Dark theme button</Button>
  </Story>
</Canvas>
```

If you need to render a story without a theme provider, you can opt-out using the `disableThemeMui` parameter:

```jsx
<Canvas>
  <Story name="No theme button" parameters={{ disableThemeMui: true }}>
    <Button>No theme button</Button>
  </Story>
</Canvas>
```

### Sidebar

Our sidebar is configured so that our folders are sorted by relevance (top-to-bottom). We start by components in order of status (i.e. from finalized components to those still on the roadmap), theme data, CSS, and finally, documentation. Within those folders, we sort alphabetically.

Within each component folder, the structure of the sidebar is dictated by the `name` parameter passed to each `<Story>` element on the page. These headings are intended to capture the full range of component variants, starting with the default APIs and ending with the dark theme.

```jsx
// The initial story will look something like this, resulting in the "API" anchor in the sidebar
<Canvas>
  <Story name="API">{(args) => <Button {...args} />}</Story>
</Canvas>
```

Note that stories can be hidden from the sidebar by adding a suffix of `"- Dev"` to the title in the `<Meta>` component. This is useful for dev-only sandboxes, or draft stories that are not quite ready to be published.

```jsx
<Meta
  component={Component}
  id="components/sandbox"
  title="Digital HIG/Components: Published/Sandbox - Dev"
/>
```

A more in-depth explanation of expected structure follows in the section below.

## Elements of a well-written story

Storybook is the primary medium for conveying the Digital HIG design system to consuming engineering teams. As such, consistency across all component stories is important, as it helps provide a reliable experience for these teams, and makes finding pertinent information easier.

### Imports

In general, we use the following four components from the "addon-docs" Storybook library:

```jsx
import { ArgsTable, Canvas, Meta, Story } from "@storybook/addon-docs";
```

The `<Meta>` component contains the metadata for the particular story, including the component being showcased, the path ID, title, page-wide parameters, and any default arguments. A typical wrapper component will import the args from the component's `defaultProps`, but for MUI components, these defaults can be passed in manually, e.g.

```jsx
<Meta
  args={{
    icon: <AlertIcon severity="success" alt="success icon" />,
    severity: "success"
  }}
  component={Alert}
  id="components/alert"
  title="Digital HIG/Components: Published/Alert"
/>
```

Note that while still in development, the title will have the path `"Digital HIG/Components: In progress/Component"`. This path should be continually updated as it moves through the status pipeline.

The `<ArgsTable>` component is placed directly below the first story, and automatically generates an interactive table with props based on the `args` and `argTypes` passed in to the `<Meta>` component. The `story` prop must match the string provided to the initial story, typically `"API"`.

```jsx
<ArgsTable story="API" />
```

The `<Canvas>` and `<Story>` elements are used to illustrate each variant of the component. We precede each story with a heading, and a brief description, if relevant.

```md
### Size options

Accepts `medium` (default) or `small`, which renders a slightly smaller button.

<Canvas>
  <Story name="Size options">
    {...}
  </Story>
</Canvas>
```

An important point to note is that component abstractions do not translate well to the outputted source code in Storybook. For example, while an abstraction such as the one in the following code block may reduce the total amount of code on the page, it will produce unclear implementation information for the consumer.

```jsx
export const AlertGroup = ({ variant = "standard", displayClose }) => {
  return (
    <>
      <Alert
        severity="info"
        icon={<AlertIcon severity="info" variant={variant} alt="info icon" />}
        variant={variant}
        onClose={displayClose ? () => {} : null}
      >
        Info
      </Alert>
      <Box my={3} />
      <Alert
        severity="error"
        icon={<AlertIcon severity="error" variant={variant} alt="error icon" />}
        variant={variant}
        onClose={displayClose ? () => {} : null}
      >
        Error
      </Alert>
      <Box my={3} />
      <Alert
        severity="success"
        icon={
          <AlertIcon severity="success" variant={variant} alt="success icon" />
        }
        variant={variant}
        onClose={displayClose ? () => {} : null}
      >
        Success
      </Alert>
      <Box my={3} />
      <Alert
        severity="warning"
        icon={
          <AlertIcon severity="warning" variant={variant} alt="warning icon" />
        }
        variant={variant}
        onClose={displayClose ? () => {} : null}
      >
        Warning
      </Alert>
    </>
  );
};
```

![Improperly formatted source code](./images/writing-documentation/002.png)

As a result, these abstractions should generally be avoided in favour of providing clear implementation guidance to consuming teams.

### Parameters

In the [theme section](#theme), we discussed the theme parameters (`theme` and `disableThemeMui`), but there are a few more of note. The `vr` parameter can be used to disable visual regression tests, either for the entire page by passing it to the `<Meta>` component, or on a story-level basis, passing it to the `<Story>` component.

Note that this should usually only be done temporarily, e.g. while investigating a flaky test. Stories with animated elements are an example of stories that can remain permanently disabled, as the different frames will result in shifting snapshots.

```jsx
<Story name="Loading" parameters={{ vr: false }}>
  <AnimatedComponent />
</Story>
```

Another useful parameter is `docs`, which can be used to format the source code outputted in the "Show code" panel.

```jsx
<Meta
  parameters={{
    docs: {
      source: {
        type: "code"
      },
      transformSource: (input) =>
        prettier.format(input, {
          parser: "babel",
          plugins: [prettierBabel]
        })
    }
  }}
/>
```

### Partials

Partials are reusable pieces of information that are imported into the Storybook and reused across various stories, located in `packages/docs/partials`. Most of them are used consistently for each component (more information in the [structure section below](#structure)), but a few are only for specific purposes.

For example, we use the `WarningNotice` for components where development has not yet been started, directly under the title.

```jsx
import { WarningNotice } from "../../../docs/src/partials";

# List

<WarningNotice />;
```

### Structure

The exact expected structure for a Digital HIG Storybook page can be ([found on Github](https://git.autodesk.com/dpe/iccc/blob/9b293c26f74624d33cddf01a9da921d86e9d63a9/packages/_dummy/src/stories/doc--dummy.stories.mdx?plain=1)).

Each story should follow a format consisting of the following sections:

```md
Component name
└── Version notice partial (wrapper components only)
└── Link to MUI component
└── Link to Figma sticker sheet
└── Installation
├── Installation partial
└──Import info
└── API
├── Link to MUI API
├── Initial story
└── Args table
└── Variants
├── Variant range partial
│ ├── Example variant
│ │ └── Example variant story
│ └── Dark theme
│ ├── Dark theme partial
│ └──Dark theme story
└── Accessibility
├── Relevant accessibility details
├── Relevant accessibility details story
└── Link to MUI component's accessibility section
```

## Useful links

- [Why Storybook?](https://storybook.js.org/docs/react/why-storybook)
- [Storybook MDX API](https://storybook.js.org/docs/react/api/mdx)
- [Writing MDX Docs](https://storybook.js.org/docs/react/writing-docs/mdx)
- [Structuring your Storybook](https://storybook.js.org/blog/structuring-your-storybook/)
- [Storybook best practices](http://ui.zenefits.com/#!/Storybook%20Best%20Practices)
- [Documenting design systems with Storybook](https://levelup.gitconnected.com/documenting-design-systems-with-storybook-docs-e54b2fa5203)
