import { Meta } from "@storybook/addon-docs";

<Meta
  title="Digital HIG/Documentation/Contributing/API design approach"
  parameters={{
    viewMode: "docs",
    previewTabs: {
      canvas: { hidden: true }
    }
  }}
/>

# API design approach

Digital HIG APIs are an extension of [MUI's API design approach documentation](https://mui.com/material-ui/guides/api/). We strongly suggest going through this article to learn how Digital HIG builds on top of MUI.

## Table of contents

- [Motivation](#motivation)
- [Composition vs abstraction](#composition-vs-abstraction)
- [Component development](#component-development)
- [Component coding patterns](#component-coding-patterns)
- [Useful links](#useful-links)

## Motivation

- **Consistency:** API use will provide more component usage consistency throughout consuming teams.

- **Flexibility:** Serving API options enables consuming teams to maintain certain flexibility according to their needs.

- **Documentation:** Once our API options are available to consumers, they can be documented for easier universal access (via Storybook).

## Composition vs abstraction

We follow the MUI guidelines regarding composition:

> 1. Using the `children` prop is the idiomatic way to do composition with React.
> 2. Sometimes we only need limited child composition, for instance when we don't need to allow child order permutations. In this case, providing explicit props makes the implementation simpler and more performant; for example, the `Tab` takes an `icon` and a `label` prop.

—[MUI API design approach - Composition](https://mui.com/material-ui/guides/api/#composition)

When working on Digital HIG implementation, we often have to choose between two extremes of a range:

- **Abstraction:** Providing an extensive API with many props, or
- **Composition:** Sharing instructions for consuming teams to build combinations as per their needs.

Like most things in life, neither extreme is good by itself, so we have to make deliberate decisions to decide the right level of abstraction for our libraries.

#### An example of abstraction is the [button component](/story/components-button--default-button):

- Most of **button** capabilities are enabled by props:

```jsx
// A typical instance of the button component
<Button layout="hug" size="defaultSize" variant="contained">
  Button label
</Button>
```

- **Button** component variants:

<img
  width="500"
  src="./images/api-design-approach/004.png"
  alt="Button component variants"
/>

#### An example of composition is the [card component](/story/components-card--cover-and-body):

- **Card** is a good example of a component with a minimal API that relies mostly on composition to express multiple variations:

```jsx
// A typical instance of the card component
<Card className="">
  <CardMedia
    alt="Alt text"
    image="https://swc.autodesk.com/pharmacopeia/img/placeholders/960x640.png"
  />
  <CardContent>
    <Typography
      sx={{
        mb: 3
      }}
      variant="eyebrow"
    >
      Eyebrow
    </Typography>
    <Typography
      sx={{
        mb: 3
      }}
      variant="headline-medium"
    >
      Headline ut risus sed risus pellentesque at.
    </Typography>
    <Typography>
      Sit nulla leo eu vestibulum fermentum aliquam suspendisse tortor. Egestas
      amet aliquam euismod lobortis ac eget placerat.
    </Typography>
  </CardContent>
</Card>
```

- **Card** component variants:

<img
  width="400"
  src="./images/api-design-approach/005.png"
  alt="Card component variants"
/>
<img
  width="400"
  src="./images/api-design-approach/002.png"
  alt="Card component variants"
/>

- **Composition** should always be a default feature of most Digital HIG components, as it encourages consumers to use components in a way that feels natural in React development. It does not impose limitations on how components can be combined to produce many possible variations.
- Incorporating **abstraction** is a good choice when we want to control component possible variations, as defined by the design system.

## Component development

### To wrap or not to wrap

- The path of least resistance to creating new components is to use MUI theming feature to style out-of-the-box MUI components.
  This allows us to rely on [MUI documentation](https://mui.com/material-ui/getting-started/overview/) and field-tested implementation.
  However, sometimes design specifications will require us to extend the MUI component capabilities.
  For example [Checkbox](/docs/components-checkbox--api) component needs to have an error state variant: `<Checkbox error />`. This is something that MUI does not provide.

- Applying a wrapper to MUI components gives us the control to surface relevant variants as they apply to Digital HIG, as well as to apply our defaults.
  We can provide documentation for our custom use cases, and then link to the related MUI documentation for everything else, saving us effort in maintaining docs.

- Theming wrapped MUI components mean that standalone MUI components wrapped in our theme will automatically receive most Digital HIG styles, which eases development work for any future application using MUI that wants to shift onto Digital HIG.

If we come across any of these reasons we can go ahead and create a Digital HIG package.

### Creating a new component

- To know more about the components file structure go to the [Coding convention page](/docs/iccc-documentation-contributing-coding-conventions--page#how-a-typical-component-is-structured).

- Digital HIG components that have a similar MUI component should be built by pulling in that MUI component (or set of components) and using it as a base for applying Digital HIG styles and variants.

- Digital HIG components should ensure that all styles adhere to the [Digital HIG design system](https://iccc.autodesk.com/). To achieve this, always refer to the [Figma Digital HIG UI Toolkit](https://www.figma.com/file/NpV47EII6zCxkpPoChejg0/%E2%9D%96-iccc-UI-toolkit?node-id=0%3A1) to see how the component should look and behave.

- More global styles can be included in the default theme properties, and styles specific to a component should be added within `overrides` in the theme object. [Learn how to customize all instances of a component in the base theme using overrides](https://mui.com/material-ui/customization/theme-components/#global-style-overrides)

### Theme data

Using the `theme data` set (which includes all foundational properties for Digital HIG styling) is a requirement for Digital HIG components.

- Explore the [Theme Data Storybook section](https://storybook.digital-help-stg.autodesk.com/iccc/current/index.html?path=/story/iccc-theme-data-overview--page)

#### Custom theme data

If you have a property for your component that doesn’t map directly to an existing theme data primitive or token (such as a new color), have a conversation with the designer to determine how to handle it.

- If it is a one-off property, only applicable to that component, add it as a hard-coded value.
- If it has a broader application, determine with the designer if it should live in a primitives or tokens file, to be reusable in the future by other components.

To know more about the file structure, naming or other conventions, please refer to the [Digital HIG coding conventions page](/docs/iccc-documentation-contributing-coding-conventions--page)

Once a component is wrapped the package.json locks the version of the component we use.
Digital HIG's engineering team is responsible for maintenance and upgrading to new MUI versions of the components.

## Component coding patterns

### Custom Digital HIG classnames

We hook styles to elements using classnames. For example, different variants of a component can be expressed by dynamically adjusting the classnames that the element is rendered with.

For example, the state MUI API of the [Accordion](/docs/components-accordion--api) component does not provide style or size variants.

- Use this pattern to create classes for components variants: `Dhig<COMPONENT_NAME>--<VARIANT_NAME>--<VARIANT_VALUE>`

- For the dense size and the flat style of accordion, replace slots accordingly:

```
DhigAccordion--size--normal

DhigAccordion--styleVariant--flat
```

- We use this class to hook the styles for `Accordion`.

  The component style overrides files are located in the Digital HIG MUI theme package source files: `packages/theme-mui/src/themes/theme-base`.

```jsx
"&.DhigAccordion--size--dense": {
  ...;
}
,
"&.DhigAccordion--styleVariant--flat": {
  ...;
}
```

- We implement the `Accordion` component as `<Accordion size="dense" styleVariant="flat">`:

```html
<div class="DhigAccordion--size--dense DhigAccordion--styleVariant--flat">
  ...
</div>
```

- Which results in the `Accordion` with the dense and flat variants rendering as expected:

<img
  height="100"
  src="./images/api-design-approach/001.png"
  alt="Digital HIG Accordion with dense and flat variants"
/>

### Spread

> Props supplied to a component that are not explicitly documented are spread to the root element; for instance, the `className` prop is applied to the root.

—[MUI API design approach - Spread](https://mui.com/material-ui/guides/api/#spread)

We can take advantage of the spread behavior by passing the MUI API props to the wrapper.

```jsx
import MuiRadio from "@mui/material/Radio";

const Radio = (props) => <MuiRadio {...muiRadioApiPresets} {...props} />;
```

### Ref

We follow MUI's guidelines:

> The `ref` is forwarded to the root element. This means that, without changing the rendered root element via the `component` prop, it is forwarded to the outermost DOM element that the component renders. If you pass a different component via the `component` prop, the ref will be attached to that component instead.

—[MUI API design approach - Ref](https://mui.com/material-ui/guides/api/#ref)

### Prop Naming

> The name of a boolean prop should be chosen based on the **default value**. This choice allows:
>
> - The shorthand notation. For example, the `disabled` attribute on an input element, if supplied, defaults to `true`:
>
>   ```jsx
>   // ❌
>   <Input enabled={false} />
>   // ✅
>   <Input disabled />
>   ```
>
> - Developers to know what the default value is from the name of the boolean prop. It's always the opposite.

—[MUI API design approach - Prop naming](https://mui.com/material-ui/guides/api/#prop-naming)

### Usage

#### MUI components

> Material UI components work in isolation.
> They are self-supporting, and will only inject the styles they need to display.

—[MUI - Getting started - Usage](https://mui.com/material-ui/getting-started/usage/)

See the [Material Design supported component list page](https://mui.com/material-ui/getting-started/supported-components/) for relevant information on each component.

#### Digital HIG components

##### Importing

```bash
yarn add @iccc/progress
```

##### Component props

Please refer to each component's page for its own set of props.

- E.g. [Progress](/docs/components-progress--api) component:

<img
  height="80"
  src="./images/api-design-approach/006.png"
  alt="Digital HIG Progress"
/>

```js
import * as React from "react";
import Progress from "@iccc/progress";

function App() {
  return (
    <Progress
      displayPercentage
      label="Progress Label"
      shape="bar"
      size="medium"
      type="determinate"
      value={67}
    />
  );
}
```

### Testing

MUI components have a wide range of tests so that we can confidently iterate on the components, therefore only the capabilities provided by Digital HIG are tested.

To see our testing effort please refer to [Testing strategy](/story/iccc-documentation-contributing-testing-strategy--page).

## Useful links

- [Material UI - Overview](https://mui.com/material-ui/getting-started/overview/)
- [MUI API design approach documentation](https://mui.com/material-ui/guides/api/)
- [Digital HIG CONTRIBUTING.md file](https://git.autodesk.com/dpe/iccc/blob/master/CONTRIBUTING.md#component-development-iccc)
