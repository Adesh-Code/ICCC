import { Meta } from "@storybook/addon-docs";

<Meta
  title="Digital HIG/Documentation/Contributing/Coding conventions"
  parameters={{
    viewMode: "docs",
    previewTabs: {
      canvas: { hidden: true }
    }
  }}
/>

# Coding conventions

Follow these guidelines when contributing to the Digital HIG library to help improve the readability of the source code and make software maintenance easier.

## Table of contents

- [Motivation](#motivation)
- [File structure](#file-structure)
- [Naming](#naming)
- [Comments & documentation in code](#comments--documentation-in-code)
- [Syntax & formatting](#syntax--formatting)
- [Accessibility](#accessibility)
- [Useful links](#useful-links)

## Motivation

### Be consistent!

> For any style question that isn't settled definitively by this specification, prefer to do what the other code in the same file is already doing. If that doesn't resolve the question, consider emulating the other files in the same package.

—[Google style guide](https://google.github.io/styleguide/jsguide.html#policies-be-consistent)

## File structure

### Monorepo organization

All of the Digital HIG code is stored in a single repository, i.e. [monorepo](https://monorepo.tools/) architecture. Each [folder under `/packages`](https://git.autodesk.com/dpe/iccc/tree/master/packages) represents a discrete piece of functionality. While the majority of packages represent components, there are a few special modules with a unique internal structure: the reference app, theme data, and theme MUI (more details about these three folders follow below).

### Components

Components let you split the UI into independent, reusable pieces, and think about each piece in isolation. Component folders do not include any styling/CSS files; all styling is done via the MUI theme overrides in the `theme-mui` package (see the [theme MUI section below](#theme-mui) for more info).

The component structure is displayed below.

```jsx
packages
└── component
    ├── src // Component source code
    │   ├── __snapshots__ // Jest-generated test snapshots
    │   ├── stories // Storybook files
    │   │   └── doc--component.stories.mdx // Markdown file with component documentation
    │   ├── index.js // Entry point for the component
    │   ├── component.js // Main module containing component code
    │   ├── component.spec.js // Jest unit tests
    │   └── constants.js // Constants (used for prop definitions and Storybook docs)
    ├── package.json // Manifest containing the component's name, version, dependencies, etc.
    └── CHANGELOG.md // Auto-populated by Lerna
```

### Reference app

The Digital HIG reference app is a React app that is used to test and showcase the components in the Digital HIG library. The reference app is located in the `packages/ref-app` directory. Please refer to the [README](https://git.autodesk.com/dpe/iccc/tree/master/packages/ref-app#readme) for more information.

### Theme data

Theme data consists primarily of primitives and tokens (for a full list, see our [theme data documentation](https://git.autodesk.com/docs/iccc-theme-data-overview--page)). These values enable us to make changes to the design system data in one place and have it reflected across all the components. It also allows us to use the design system data in other packages.

#### Primitives

Primitives are the pool of key-value pairs that describe available design system options. They are organized by role: color, font weight, font size, etc. They help limit the scope of any given style property to preset values, which helps ensure consistency across our components, as style options are constrained to these primitive sets.

This can be especially useful for ranges, where we can vary the options across a meaningful scale.

For example, this object describes the range of Digital HIG spacing key/value pairs:

```jsx
"primitives.spacings": {
  "0": "0",
  "1": "4px",
  "2": "8px",
  "3": "12px",
  "4": "16px",
  "5": "20px",
  "6": "24px",
  "7": "32px",
  "8": "48px",
  "9": "64px"
}
```

The primitives folder is [located at `packages/theme-data/src/primitives`](https://git.autodesk.com/dpe/iccc/tree/master/packages/theme-data/src/primitives). New values can be added to the existing files, or a new file can be created as needed.

#### Tokens

Tokens are named data sets that represent a collection of values of a design entity. Their names describe their potential application, e.g. `tokens.colors["fill-success"]` indicates the fill color for success states. In code, tokens can reference primitives, other tokens, or simply assign raw values to a property.

```jsx
"tokens.button.contained": {
  "color": tokens.colors["ink-on-fill-primary"], // references another token
  "fontSize": primitives.fontSizes["3"], // references a primitive
  "flexWrap": "wrap" // assigns an arbitrary value
}
```

Unlike primitives, a token aggregates multiple style properties that together describe a design entity under a single human readable name:

```jsx
"tokens.typography.display-extra": {
  "fontFamily": "primitives.fontFamilies.display",
  "fontSize": "primitives.fontSizes.10",
  "fontWeight": "primitives.fontWeights.display",
  "lineHeight": "primitives.lineHeights.tight"
}
```

The token folders (base, light, and dark) are located at `packages/theme-data/src/themes`. The dark tokens extend the light ones, so editing both files is only needed where values differ across the two themes.

Note that we have deprecated the practice of creating tokens on a component-level basis, so they are used instead for global abstractions, e.g. colors, effects, gradients, etc. The base tokens are consistent across both themes, i.e. colorless values (typography, opacity, transitions, etc.).

### Theme MUI

In our `ThemeMUI` JSON library, we extend [MUI's default theme](https://mui.com/material-ui/customization/default-theme/) and apply style overrides for each component. As mentioned above, we use the primitives and tokens for style values wherever possible.

```jsx
// hooks styles to a particular MUI component
MuiFormControlLabel: {
  // uses MUI component API
  root: {
    // applies a design system value to a CSS rule
    marginLeft: primitives.spacings["0"];
  }
}
```

We create a unique styling file for each component rather than adding it directly to the theme object in `theme-base.js`, as this improves readability. Each file name follows the pattern `component.js`, and is located in the `theme-base` folder.

Targeting MUI CSS class selectors rather than adding specifically-designed class names is advised wherever possible. There are rare occasions when direct selectors are needed; for example, we needed a custom class for our text area counter, as this was something that didn't come out-of-the-box with MUI's form control or text input components:

```jsx
MuiFormControl: {
  styleOverrides: {
    root: {...},
    // matches an element with class "DhigTextInput--count" nested inside the component root
    "& .DhigTextInput--count": {
      color: tokens.colors["ink-on-background-60"],
      fontSize: primitives.fontSizes["1"],
      textAlign: "right",
      margin: `${primitives.spacings["2"]} ${primitives.spacings["0"]}`
    },
    ...
  }
}
```

Theme data is injected into our build script binding our design system to MUI components.

## Naming

In general, we follow the guidelines from [Google's style guide](https://google.github.io/styleguide/jsguide.html#naming).

### Guidelines

Here are some other guidelines to follow when naming things in the Digital HIG codebase:

#### File names

- File and folder names should be in kebab case (e.g. `file-name.js`) and should be descriptive of the component or file they are associated with.
- Storybook Markdown files are formatted as `doc--component-name.stories.mdx`.

#### Components

All React components should be named in Pascal case. e.g. `<MyComponent />`

#### Variables and props

- When using an initialism in a variable name, treat it as a word, e.g. `renderHtml` instead of `renderHTML`.
- All constants should be named in screaming snake case, e.g. `const MY_CONSTANT = 'value'`
- All functions should be named in camel case, e.g. `function myFunction() {}`

#### CSS

We use the "Dhig" prefix for all CSS classes, followed by the name of the component in Pascal case, e.g. `DhigButton`. If a variant name or feature name needs to be added to the class, it must be lowercase and bonded with "--", e.g. `DhigIconButton--variant--cardAction` or `DhigAccordion--size--dense`.

## Comments & documentation in code

> Programs must be written for people to read and only incidentally for machines to execute.

—Hal Abelson

### JSDoc

We use [JSDoc](https://jsdoc.app/) to document our code. JSDoc is one of the standard API documentation generators for JavaScript. For more information on correct usage, please see [JSDOC's "getting started" guide](https://jsdoc.app/about-getting-started.html).

### Comments

> Be generous with comments. It is useful to leave information that will be read at a later time by people (possibly your future self) who will need to understand what you have done and why. The most valuable comments talk about intentions and reasons, things that are not easily discovered by reading the code. The comments should be well-written and clear, just like the code they are annotating. An occasional nugget of humor might be appreciated. Frustrations and resentments will not.

—Douglas Crockford, [Code conventions for the JavaScript programming language](https://www.crockford.com/code.html)

#### Here are some rules we adhere to regarding comments:

❌ Comments should not duplicate the code.

```jsx
// React useState hook sets the initial value to 0
const [value, setValue] = useState(0);
```

❌ Good comments do not excuse unclear code.

❌ If you can’t write a clear comment, there may be a problem with the code.

```jsx
/* You are not expected to understand this */
```

✅ Comments should dispel confusion, not cause it.

✅ Explain unidiomatic code in comments.

✅ Provide links to the original source of copied code.

```jsx
// MUI Card API: https://mui.com/material-ui/api/card/
const muiCardApiPresets = {
  ...
}
```

✅ Include links to external references where they will be most helpful.

```jsx
// See the RTL docs for more information about query priority:
// https://testing-library.com/docs/queries/about#priority
```

✅ Add comments when fixing bugs.

✅ Use comments to mark incomplete implementations.

```jsx
// Remove this notice once all the variants have been implemented
if (unavailableTypes.includes(type)) {
  ...
}
```

**References:**

- [Best practices for writing code comments](https://stackoverflow.blog/2021/12/23/best-practices-for-writing-code-comments/)
- [Odd comments and strange doings in Unix](https://web.archive.org/web/20070220094221/http://cm.bell-labs.com/cm/cs/who/dmr/odd.html)

## Syntax & formatting

- We follow best practices and industry standards inspired by [Google](https://google.github.io/styleguide/jsguide.html) and [Airbnb](https://github.com/airbnb/javascript).
- Formatting standards exist so that we can have consistency across the codebase. The standards are enforced by the linters; in our case, we use [ESLint](https://eslint.org/) and [Prettier](https://prettier.io/). The formatting rules are defined in the `.eslintrc` and `.prettierrc` files in the root of the project.
- Code checks and linters verify code on branch commits (through the pre-commit hook). If there are any errors, the commit will fail.

## Accessibility

We follow the [WCAG 2.1](https://www.w3.org/TR/WCAG21/) guidelines for accessibility, and use the `jsx-ally` plugin for ESLint to enforce accessibility rules. For more information, please refer to our [accessibility implementation and validation docs](/docs/iccc-documentation-contributing-accessibility-implementation-and-validation--page).

## Useful links

JavaScript style guides:

- [Google](https://google.github.io/styleguide/jsguide.html)
- [Airbnb](https://github.com/airbnb/javascript)
- [MDN](https://developer.mozilla.org/en-US/docs/MDN/Writing_guidelines/Writing_style_guide/Code_style_guide/JavaScript)
