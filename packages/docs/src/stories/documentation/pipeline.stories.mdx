import { Meta } from "@storybook/addon-docs";

<Meta
  title="Digital HIG/Documentation/Contributing/Pipeline - Dev"
  parameters={{
    viewMode: "docs",
    previewTabs: {
      canvas: { hidden: true }
    }
  }}
/>

# CI/CD pipeline

The Digital HIG team maintains a pipeline that automatically creates testing environments for code contributions and publishes new versions of packages to be used by consuming teams. Jenkins is used to automate the tasks of building, testing, and publishing design system deliverables. Opening a pull request will trigger the branch code to be deployed to a pre-release environment.

## Table of contents

- [Pipeline overview](#pipeline-overview)
- [Pull request readiness](#pull-request-readiness)
- [What to expect after a pull request is open?](#what-to-expect-after-a-pull-request-is-open)
- [Pull request resolving](#pull-request-resolving)
- [Post merge expectations](#post-merge-expectations)
- [Troubleshooting the pipeline](#troubleshooting-the-pipeline)
- [Content that might be needed](#content-that-might-be-needed)
- [Troubleshooting the pipeline](#troubleshooting-the-pipeline)
- [References](#references)

## Pipeline overview

- Links to our Jenkins branch and details about Digital HIG's implementation. (How to request access if you don't have access to DHIG Jenkins/admin access to re-run builds)
- **CI Architecture Overview**
  - Create a flowchart showing an overview of the pipeline used at Digital HIG ([Example #1](https://www.jenkins.io/doc/book/resources/pipeline/realworld-pipeline-flow.png) [Example #2](https://docs.gitlab.com/ee/development/cicd/img/ci_architecture.png)[ ](https://www.jenkins.io/doc/book/resources/pipeline/realworld-pipeline-flow.pnghttps://www.jenkins.io/doc/book/resources/pipeline/realworld-pipeline-flow.png))
  - Some things to cover: Events to trigger the pipeline, what tests run as part of the pipeline(project test dependency - Applitools, Cypress, Jest, Code Scanners), rebuilding the pipeline.
  - How and why branches are named. (Guideline for CFP developers only)
  - Any configuration details of our pipeline.

## Pull request readiness

(Document steps to open a PR)

- Link this page inside the [contribution guidelines](https://git.autodesk.com/dpe/iccc/blob/master/CONTRIBUTING.md).
- Verify that all items in the pull request template have been addressed before opening a pull request to avoid unnecessary feedback cycles. Also, consider adding screenshots or gif captures if needed to the description.
- Alternatively, if you want early feedback, or need to test directly in a pre-release environment, open a draft pull request
- How to better prepare your pr for easy review.
  - Outline leaving comments to help the reviewer
  - Reference Links to good PR descriptions: ([Link#1](https://git.autodesk.com/dpe/address-input-mfe/pull/49); [Link#2](https://git.autodesk.com/dpe/iccc/pull/373))

## What to expect after a pull request is open?

- The Digital HIG pipeline will automatically run tests and deploy a pre-release environment for the branch.
- Documenting output of PR builds. (Monitoring `#priv-cfp-dhig-notifs` channel to see the output of builds. (examples of successful and failed builds)
- Link to the pre-release environment for the branch along with other details about the build.
- Every time a new commit is pushed to the branch, the pipeline will run again and update the pre-release environment.
- Submitting PR for review to Digital HIG engineers.
- Resolving comments.

## Pull request resolving

(How to verify a PR job runs successfully & what to do if it does not)

- Overview of GitHub pr page checks section.
  - Explanation of ticks for successful builds
  - Explanation of Jenkins, branch, pr-head.
- Link to troubleshooting the pipeline in the above section (or move it here)
- Link to testing strategy for more information on passing VR and other tests.
- (Maybe) link to Autodesk Jenkins status slack channel; (Incase Jenkins goes down)

## Pull request merging strategy

(How and when to merge?)

- The acceptance criteria must be met for the user story.
- The procedure we follow for merging pull requests
  - Approvals - make sure all pending comments are addressed and the person who has left them has given you their approval.
  - Baseline Upgrades. (How will contributing teams announce this?)
  - Rebasing to master. (and why it is needed)
- clearing up the commit log and squashing commits.
- Rebuilding after baseline to have a green squash and merge button.
- Expected build time for the pipeline to complete.

## Post-merge expectations

(What happens after merging?)

- Role of the Lerna build system after merging.
- How to see the build status of the master branch (as it is different from the PR build).
- What to do if you break the master build?
- (Maybe) specific build time for master - as it takes much longer to build and deploy.

## Troubleshooting the pipeline

- Reasons for pipeline failure. (expected v/s unexpected)
- Rebuilding the pipeline.
- Rebuilding pipeline skipping VR.
  - when is it needed; when it should not be skipped.
  - Link to the VR section in the testing strategy docs [Link](https://storybook.digital-help-stg.autodesk.com/iccc/current/index.html?path=/docs/iccc-documentation-contributing-testing-strategy--page#visual-regression-tests-with-applitools)
  - Overview of the Jenkins log - how to read it, locate visual regression link, and important information with examples in the Jenkins log/console output.

## Content that might be needed

- Checking if packages were published in the artifactory.

## References

- Use Nicolas pr review video as reference: [Link](https://autodesk.zoom.us/rec/share/c4ULVIIfWJkuHorkXJoJ2Z5RHQrGEWFK5cJiTorYQa1aTpbF5Gzl3-oEn5MDWFWP._-nkz8C7e7kBQM69); pass code: 421t=VUF
